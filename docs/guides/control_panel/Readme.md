PIT Control Panel
================

### By Simtech Solutions Inc ###

##API Documentation##
For the full API Documentation, please follow the link below

[Control Panel API Documentation](../api-docs/api)


### Release Notes ###

### December 31st 2014 ###

### Version 0.1.05 ###

- Fixed issues c17, c30, c29, c2, c5 and c55
- Fixed issue where user info wouldn't update until next login

### December 31st 2014 ###

### Version 0.1.04 ###

- Completed the User Info API

### December 24th 2014 ###

### Version 0.1.03 ###

- Fixed error message occuring when adding regions

### December 15th 2014 ###

### Version 0.1.02 ###

- Completed first round of fixes found by Cloudburst

-------------------------------
###Requirements

- Railo v4.2.008 (http://www.getrailo.org/index.cfm/download/)
- MySQL 5.6 (https://dev.mysql.com/downloads/mysql/)
- Sencha CMD 5.1.026 (https://www.sencha.com/products/extjs/cmd-download/)
- ExtJS 5.1.1 (https://www.sencha.com/legal/GPL/)
- Web server (IIS, Apache, etc)
- PowerShell

{@img control_panel_diagram.png REST}

###Getting Started

1. Install and set-up all the items listed in Requirements above. Please see each download site for instructions on initial set-up of each requirement.

1. Download the codebase, either by cloning the repo or downloading the zip file.

1. The directory where the codebase resides on your computer will be referred to as SITE_HOME in these instructions.

1. Set your webserver's webroot to SITE_HOME/build/production/PIT_CP

1. Login to the railo web administrator by browsing to [YOUR_DOMAIN]/railo-context/admin/web.cfm.

	Click on "Rest" under the "Archives and Resources" section in the left hand nav and Set-up a new mapping with the following details:

		- Virtual: /pit
		- Physical: /rest/pit

	{@img railo_rest.png REST}

	Click on "Datasource" in the left hand nav and under "Create new Datasource", select MySQL and give it the name "PITAPI". Note: if this name is changed for any reason, sure to change the THIS.datasource property in Application.cfc in both /rest/pit and /reset.

	Complete the rest of the information required to set-up the datasource, including server address (likely localhost), username, password, database name, etc.

	{@img railo_datas.png Datasource}

	{@img railo_datas2.png Datasource}

3. If you are using Windows, run the build.ps1 PowerShell script in your SITE_HOME, if you are using a non-Windows operating system you will need an alternative script or run the commands manually shown below.  To run a PowerShell script, open a PowerShell window by running 'powershell' at your command prompt, navigate to the script directory, type the script's name (with or without the .ps1 extension), and press Enter.

	This script will run 'sencha app build production' to produce a production ready package of all the front-end javascript. And it will also copy the backend scripts needed for the API to the proper folder. To do this without using the script, if you are using Linux for example, simply complete the following steps.

	1. Navigate to the SITE_HOME directory
	1. Run the command `sencha app build production`
	1. Copy all files from SITE_HOME/rest to SITE_HOME/build/production/PIT_CP/rest. These are all the files required for the backend.
	1. Copy all files from SITE_HOME/reset to SITE_HOME/build/production/PIT_CP/reset. These are all the files required for a user to reset their password
	1. Copy version.json to SITE_HOME/build/production/PIT_CP/version.json


##Folder Structure

Below is a description of key folders

- **/app ** - All the front-end javascript source files go here. The folder is further broken down into logical subdirectories for controllers, models, stores, and views. Sencha CMD will look in this folder during the build process

- **/ext ** - This is the ExtJS Source Folder. Generally speaking, no changes should be needed here. This folder was created automatically by Sencha CMD during the application create process

- **/packages ** - All the styling/theming is done in this folder. ExtJS uses the concept of packages to handle themeing, so a new 'pit-theme' package was created that has all the custom styling used for the control panel. See http://docs.sencha.com/extjs/5.1/core_concepts/theming.html for a good introduction to how themeing works in ExtJS

- **/reset ** - This folder contains all the code necessary to display the Password Reset page. This is done in a separate folder since it involves different access controls (no login required). It consists of one page that will display the form to reset the password and then will display a confirmation once the password is reset.

- **/resources ** - Autogenerated by Sencha CMD as a place to put all required resources, such as images for the front-end.

- **/rest ** - All the backend logic goes here. It's in a subfolder called "pit" to allow for the possibility of other related by disparate API endpoints to be added. As an example, you may want to keep all functions related to administrator of the app in pit, but then extend this to be able to accept the survey responses, in which case you could add a new folder, "datastore" and have the app send all responses to /rest/datastore.
The **/rest/pit ** directory contains multiple subfolders to keep everything organized
	- **/rest/pit/cfc ** - A folder to place the required CFC (ColdFusion Components) that are used throughout the app. The two currently in there are json.cfc, which is used to convert data to JSON strings, and udf.cfc, which has several user-defined utility functions that are used in various places throughout the application.
	- **/rest/pit/db ** - This folder contains the database schema, broken out by version. As opposed to having 1 master database schema file, we separated it out so we could have the inital, base-schema (v1.00), and then any changes that needed to be made after were added to a new versioned file. The intent is that these files can be run in chronological order and the end result will be an exact working replica of the database. This prevents the need from having to start with a completely fresh database each time, as the script should allow in-place updates from any given version to the latest.
	- **/rest/pit/docs ** - A folder containing javadoc like documentation for all the components and methods used for the back-end
	- **/rest/pit/Application.cfc ** - This file serves as an entry point into the Application. It is a requirement of ColdFusion, and is fully documented at [http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-74fa.html](http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-74fa.html "http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-74fa.html").
	- **/rest/pit/[endpoint].cfc - Each remaining .cfc file in this directory handles all the requests to the endpoint with the matching name. For example, auth.cfc handles all requests sent to /rest/pit/auth/.  Within these files are functions to handle the different request types and sub-paths for each endpoint. For more detail on each file, see the /docs folder
